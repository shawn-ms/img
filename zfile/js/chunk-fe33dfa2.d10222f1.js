(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fe33dfa2"],{4889:function(e,t,a){"use strict";var i=a("4f80"),o=a.n(i);o.a},"4f80":function(e,t,a){},"8d1d":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{offset:1,"element-loading-text":"保存并初始化中."}},[a("h1",[e._v("驱动器列表")]),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addDrive}},[e._v("新增")])],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.driveList}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"100"}}),a("el-table-column",{attrs:{prop:"name",label:"驱动器名称"}}),a("el-table-column",{attrs:{prop:"type",formatter:e.typeFormatter,width:"150",label:"所属策略"}}),a("el-table-column",{attrs:{prop:"enableCache",width:"150",label:"缓存开启"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{on:{change:function(a){return e.switchEnableStatus(t.row)}},model:{value:t.row.enableCache,callback:function(a){e.$set(t.row,"enableCache",a)},expression:"scope.row.enableCache"}})]}}])}),a("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[[a("el-button",{staticClass:"el-icon-edit",attrs:{slot:"reference",size:"mini",type:"primary"},on:{click:function(a){return e.editDrive(t.row)}},slot:"reference"},[e._v("编辑")]),a("el-button",{staticClass:"el-icon-delete",attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.deleteDrive(t.row)}}},[e._v("删除")])]]}}])})],1),a("el-dialog",{attrs:{width:"80%",title:"编辑",visible:e.driveEditDialogVisible,top:"10vh","destroy-on-close":!0},on:{"update:visible":function(t){e.driveEditDialogVisible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"element-loading-text":"保存并初始化中.",id:"siteForm",model:e.driveItem,rules:e.rules,"label-width":"auto","status-icon":!0}},[a("el-row",{attrs:{gutter:50}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"驱动器名称",prop:"name"}},[a("el-input",{model:{value:e.driveItem.name,callback:function(t){e.$set(e.driveItem,"name",t)},expression:"driveItem.name"}})],1),a("el-form-item",{attrs:{label:"开启缓存"}},[a("el-switch",{model:{value:e.driveItem.enableCache,callback:function(t){e.$set(e.driveItem,"enableCache",t)},expression:"driveItem.enableCache"}}),a("div",{staticClass:"zfile-word-aux",staticStyle:{"margin-left":"0"}},[e._v("\n                                开启缓存后，N 秒内重复请求相同文件夹，不会重复调用 API。\n                            ")]),a("div",{staticClass:"zfile-word-aux",staticStyle:{"margin-left":"0"}},[e._v("\n                                参数 N 在配置文件中设置 {zfile.cache.timeout}，默认为 1800 秒。\n                            ")])],1),a("el-form-item",{attrs:{label:"存储策略",prop:"type"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择存储策略"},model:{value:e.driveItem.type,callback:function(t){e.$set(e.driveItem,"type",t)},expression:"driveItem.type"}},e._l(e.supportStrategy,(function(e){return a("el-option",{key:e.key,attrs:{label:e.description,value:e.key}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[e._l(e.storageStrategyForm,(function(t){return a("el-form-item",{key:t.title,attrs:{label:t.title,prop:"storageStrategyConfig."+t.key}},["endPoint"===t.key&&e.region.hasOwnProperty(e.driveItem.type)?a("el-select",{model:{value:e.driveItem.storageStrategyConfig.endPoint,callback:function(t){e.$set(e.driveItem.storageStrategyConfig,"endPoint",t)},expression:"driveItem.storageStrategyConfig.endPoint"}},e._l(e.region[e.driveItem.type],(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.val}})})),1):"pathStyle"===t.key?a("div",[a("el-select",{staticStyle:{width:"50%"},model:{value:e.driveItem.storageStrategyConfig.pathStyle,callback:function(t){e.$set(e.driveItem.storageStrategyConfig,"pathStyle",t)},expression:"driveItem.storageStrategyConfig.pathStyle"}},[a("el-option",{attrs:{label:"bucket-virtual-hosting",value:"bucket-virtual-hosting"}}),a("el-option",{attrs:{label:"path-style",value:"path-style"}})],1),a("el-link",{staticClass:"zfile-word-aux",attrs:{target:"_blank",icon:"el-icon-document",href:"https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/dev/VirtualHosting.html#path-style-access"}},[e._v("查看 S3 API 说明文档")])],1):"isPrivate"===t.key?a("div",[a("el-switch",{model:{value:e.driveItem.storageStrategyConfig.isPrivate,callback:function(t){e.$set(e.driveItem.storageStrategyConfig,"isPrivate",t)},expression:"driveItem.storageStrategyConfig.isPrivate"}}),a("span",{staticClass:"zfile-word-aux"},[e._v("私有空间会生成带签名的下载链接")])],1):a("el-input",{attrs:{placeholder:""},on:{input:function(t){return e.change(t)}},model:{value:e.driveItem.storageStrategyConfig[t.key],callback:function(a){e.$set(e.driveItem.storageStrategyConfig,t.key,a)},expression:"driveItem.storageStrategyConfig[item.key]"}}),"basePath"===t.key?a("div",[a("span",{staticClass:"zfile-word-aux",staticStyle:{"margin-left":"0"}},[e._v("基路径表示从哪个路径开始文件, 不填写表示从根开始")])]):e._e(),"domain"===t.key&&"ftp"===e.driveItem.type?a("div",[a("span",{staticClass:"zfile-word-aux",staticStyle:{"margin-left":"0"}},[e._v("此域名表示 http 访问域名")])]):e._e()],1)})),"onedrive"===e.driveItem.type?a("el-form-item",[a("el-link",{attrs:{target:"_blank",icon:"el-icon-edit",href:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=09939809-c617-43c8-a220-a93c1513c5d4&response_type=code&redirect_uri=https://zfile.jun6.net/onedrive/callback&scope=offline_access%20User.Read%20Files.ReadWrite.All"}},[e._v("前往获取授权")])],1):e._e(),"onedrive-china"===e.driveItem.type?a("el-form-item",[a("el-link",{attrs:{target:"_blank",icon:"el-icon-edit",href:"https://login.chinacloudapi.cn/common/oauth2/v2.0/authorize?client_id=4a72d927-1907-488d-9eb2-1b465c53c1c5&response_type=code&redirect_uri=https://zfile.jun6.net/onedrive/china-callback&scope=offline_access%20User.Read%20Files.ReadWrite.All"}},[e._v("前往获取授权")])],1):e._e()],2)],1)],1),a("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",disabled:e.loading},on:{click:function(t){return e.submitForm("form")}}},[e._v("保存")]),a("el-button",{on:{click:function(t){e.driveEditDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1)},o=[],n={aliyun:[{name:"华东 1（杭州）",val:"oss-cn-hangzhou.aliyuncs.com"},{name:"华东 2（上海）",val:"oss-cn-shanghai.aliyuncs.com"},{name:"华北 1（青岛）",val:"oss-cn-qingdao.aliyuncs.com"},{name:"华北 2（北京）",val:"oss-cn-beijing.aliyuncs.com"},{name:"华北 3（张家口）",val:"oss-cn-zhangjiakou.aliyuncs.com"},{name:"华北 5（呼和浩特）",val:"oss-cn-huhehaote.aliyuncs.com"},{name:"华南 1（深圳）",val:"oss-cn-shenzhen.aliyuncs.com"},{name:"西南 1（成都）",val:"oss-cn-chengdu.aliyuncs.com"},{name:"中国（香港）",val:"oss-cn-hongkong.aliyuncs.com"},{name:"美国西部 1 （硅谷）",val:"oss-us-west-1.aliyuncs.com"},{name:"美国东部 1 （弗吉尼亚）",val:"oss-us-east-1.aliyuncs.com"},{name:"亚太东南 1 （新加坡）",val:"oss-ap-southeast-1.aliyuncs.com"},{name:"亚太东南 2 （悉尼）",val:"oss-ap-southeast-2.aliyuncs.com"},{name:"亚太东南 3 （吉隆坡）",val:"oss-ap-southeast-3.aliyuncs.com"},{name:"亚太东南 5 （雅加达）",val:"oss-ap-southeast-5.aliyuncs.com"},{name:"亚太东北 1 （日本）",val:"oss-ap-northeast-1.aliyuncs.com"},{name:"亚太南部 1 （孟买）",val:"oss-ap-south-1.aliyuncs.com"},{name:"欧洲中部 1 （法兰克福）",val:"oss-eu-central-1.aliyuncs.com"},{name:"英国（伦敦）",val:"oss-eu-west-1.aliyuncs.com"},{name:"中东东部 1 （迪拜）",val:"oss-me-east-1.aliyuncs.com"}],tencent:[{name:"北京",val:"cos.ap-beijing.myqcloud.com"},{name:"上海",val:"cos.ap-shanghai.myqcloud.com"},{name:"广州",val:"cos.ap-guangzhou.myqcloud.com"},{name:"成都",val:"cos.ap-chengdu.myqcloud.com"},{name:"重庆",val:"cos.ap-chongqing.myqcloud.com"},{name:"深圳金融",val:"cos.ap-shenzhen-fsi.myqcloud.com"},{name:"上海金融",val:"cos.ap-shanghai-fsi.myqcloud.com"},{name:"北京金融",val:"cos.ap-beijing-fsi.myqcloud.com"},{name:"中国香港",val:"cos.ap-hongkong.myqcloud.com"},{name:"新加坡",val:"cos.ap-singapore.myqcloud.com"},{name:"孟买",val:"cos.ap-mumbai.myqcloud.com"},{name:"首尔",val:"cos.ap-seoul.myqcloud.com"},{name:"曼谷",val:"cos.ap-bangkok.myqcloud.com"},{name:"东京",val:"cos.ap-tokyo.myqcloud.com"},{name:"硅谷",val:"cos.na-siliconvalley.myqcloud.com"},{name:"弗吉尼亚",val:"cos.na-ashburn.myqcloud.com"},{name:"多伦多",val:"cos.na-toronto.myqcloud.com"},{name:"法兰克福",val:"cos.eu-frankfurt.myqcloud.com"},{name:"莫斯科",val:"cos.eu-moscow"}],huawei:[{name:"非洲-约翰内斯堡",val:"obs.af-south-1.myhuaweicloud.com"},{name:"华北-北京四",val:"obs.cn-north-4.myhuaweicloud.com"},{name:"华北-北京一",val:"obs.cn-north-1.myhuaweicloud.com"},{name:"华东-上海二",val:"obs.cn-east-2.myhuaweicloud.com"},{name:"华东-上海一",val:"obs.cn-east-3.myhuaweicloud.com"},{name:"华南-广州",val:"obs.cn-south-1.myhuaweicloud.com"},{name:"西南-贵阳一",val:"obs.cn-southwest-2.myhuaweicloud.com"},{name:"亚太-曼谷",val:"obs.ap-southeast-2.myhuaweicloud.com"},{name:"亚太-香港",val:"obs.ap-southeast-1.myhuaweicloud.com"},{name:"亚太-新加坡",val:"obs.ap-southeast-3.myhuaweicloud.com"}],qiniu:[{name:"华东",val:"s3-cn-east-1.qiniucs.com"},{name:"华北",val:"s3-cn-north-1.qiniucs.com"},{name:"华南",val:"s3-cn-south-1.qiniucs.com"},{name:"北美",val:"s3-us-north-1.qiniucs.com"},{name:"东南亚",val:"s3-ap-southeast-1.qiniucs.com"}]},s=n,r={name:"DriveList",data:function(){var e=this;return{loading:!1,driveList:[],supportStrategy:[],storageStrategyForm:[],region:s,driveItem:{name:"",type:null,searchEnable:!1,searchIgnoreCase:!1,searchContainEncryptedFile:!1,enableCache:!1,autoRefreshCache:!1,storageStrategyConfig:{endPoint:"",pathStyle:"",isPrivate:!1,accessKey:null,secretKey:null,bucketName:null,host:null,port:null,filePath:null,accessToken:null,refreshToken:null,secretId:null,username:null,password:null,basePath:"",domain:""}},driveEditDialogVisible:!1,rules:{siteName:[{required:!0,message:"请输入站点名称",trigger:"change"}],username:[{required:!0,message:"请输入管理员账号",trigger:"change"}],password:[{required:!0,message:"请输入管理员密码",trigger:"change"}],domain:[{required:!0,type:"url",message:"请输入正确的域名, 需以 http:// 或 https:// 开头",trigger:"change"}],type:[{required:!0,message:"存储策略不能为空",trigger:"change"}],"storageStrategyConfig.domain":[{validator:function(t,a,i){var o=/(http|https):\/\/([\w.]+\/?)\S*/;void 0!==a&&""!==a||"ftp"===e.driveItem.type?o.test(a)?i():i(new Error("请输入正确的域名, 需以 http:// 或 https:// 开头")):i(new Error("域名不能为空"))},type:"url",trigger:"change"}],"storageStrategyConfig.username":[{validator:function(t,a,i){"upyun"!==e.driveItem.type&&"ufile"!==e.driveItem.type||void 0!==a&&""!==a?i():i(new Error("操作员名称不能为空"))}}],"storageStrategyConfig.password":[{validator:function(t,a,i){"upyun"!==e.driveItem.type&&"ufile"!==e.driveItem.type||void 0!==a&&""!==a?i():i(new Error("操作员密码不能为空"))}}],"storageStrategyConfig.endPoint":[{required:!0,message:"区域不能为空"}],"storageStrategyConfig.accessKey":[{required:!0,message:"AccessKey 不能为空"}],"storageStrategyConfig.filePath":[{required:!0,message:"文件路径不能为空"}],"storageStrategyConfig.secretKey":[{required:!0,message:"SecretKey 不能为空"}],"storageStrategyConfig.bucketName":[{required:!0,message:"此项不能为空"}],"storageStrategyConfig.host":[{required:!0,message:"域名或 IP 不能为空"}],"storageStrategyConfig.port":[{required:!0,message:"端口不能为空"}],"storageStrategyConfig.accessToken":[{required:!0,message:"访问令牌不能为空"}],"storageStrategyConfig.refreshToken":[{required:!0,message:"刷新令牌不能为空"}],"storageStrategyConfig.secretId":[{required:!0,message:"SecretId 不能为空"}]}}},watch:{"driveItem.type":function(e){var t=this;e?this.$http.get("admin/strategy-form",{params:{storageType:e}}).then((function(e){t.storageStrategyForm=e.data.data})):this.storageStrategyForm=null}},methods:{switchEnableStatus:function(e){var t=this,a=e.enableCache?"enable":"disable";this.$http.post("admin/cache/"+e.id+"/"+a).then((function(){t.$message.success("修改成功")}))},typeFormatter:function(e,t,a){for(var i in this.supportStrategy)if(this.supportStrategy[i].key===a)return this.supportStrategy[i].description},change:function(){this.$forceUpdate()},editDrive:function(e){var t=this;this.$http.get("admin/drive/"+e.id).then((function(e){var a=e.data.data;a.type=a.type.key,t.driveItem=a})),this.driveEditDialogVisible=!0},deleteDrive:function(e){var t=this;this.$confirm("是否确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:function(a){"confirm"===a&&t.$http.delete("admin/drive/"+e.id).then((function(e){0===e.data.code?(t.$message.success("删除成功"),t.init()):t.$message.success("删除失败")}))}})},addDrive:function(){Object.assign(this.driveItem,this.$options.data().driveItem),this.driveItem.id=null,this.driveEditDialogVisible=!0},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.loading=!0,t.$http.post("admin/drive",t.driveItem).then((function(e){var a=e.data;t.$message({message:a.msg,type:0===a.code?"success":"error",duration:1500}),t.driveEditDialogVisible=!1,t.init(),t.loading=!1})).catch((function(){t.loading=!1}))}))},init:function(){var e=this;this.$http.get("admin/support-strategy").then((function(t){e.supportStrategy=t.data.data})),this.$http.get("admin/drives").then((function(t){var a=t.data.data;for(var i in a)a[i].type=a[i].type.key;e.driveList=t.data.data}))}},mounted:function(){this.init()}},l=r,c=(a("4889"),a("2877")),m=Object(c["a"])(l,i,o,!1,null,"23fc179f",null);t["default"]=m.exports}}]);